{% extends "base.html" %}

{% block title %}
{% if mode == 'register' %}Register{% else %}Login{% endif %} - Garage Door Game
{% endblock %}

{% block content %}
<div class="card" style="max-width: 500px; margin: 0 auto;">
    <h2 style="color: #fbbf24; margin-bottom: 30px; text-align: center;">
        {% if mode == 'register' %}
            ğŸ“ Create Account
        {% else %}
            ğŸ”‘ Login
        {% endif %}
    </h2>

    <form id="authForm">
        {% if mode == 'register' %}
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" class="form-control" required 
                   placeholder="Enter your username" autocomplete="username">
        </div>
        {% endif %}

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" class="form-control" required 
                   placeholder="Enter your email" autocomplete="email">
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" class="form-control" required 
                   placeholder="Enter your password" autocomplete="current-password">
            {% if mode == 'register' %}
            <small style="color: #9ca3af; margin-top: 5px; display: block;">
                Password must be at least 8 characters long
            </small>
            {% endif %}
        </div>

        <button type="submit" class="btn btn-success" style="width: 100%; margin-top: 20px; padding: 15px;">
            {% if mode == 'register' %}
                ğŸ“ Create Account
            {% else %}
                ğŸ”‘ Login
            {% endif %}
        </button>
    </form>

    <div style="text-align: center; margin-top: 25px; padding-top: 20px; border-top: 1px solid #374151;">
        {% if mode == 'register' %}
            <p style="color: #9ca3af;">Already have an account?</p>
            <a href="{{ url_for('login') }}" class="btn" style="margin-top: 10px;">
                ğŸ”‘ Login Instead
            </a>
        {% else %}
            <p style="color: #9ca3af;">Don't have an account?</p>
            <a href="{{ url_for('register') }}" class="btn" style="margin-top: 10px;">
                ğŸ“ Create Account
            </a>
        {% endif %}
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <a href="{{ url_for('index') }}" style="color: #9ca3af; text-decoration: none;">
            â† Back to Home
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('authForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = showLoading(submitBtn);
    
    try {
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        
        // Basic validation
        if ('{{ mode }}' === 'register') {
            if (!data.username || !data.email || !data.password) {
                throw new Error('All fields are required');
            }
            if (data.password.length < 8) {
                throw new Error('Password must be at least 8 characters long');
            }
        } else {
            if (!data.email || !data.password) {
                throw new Error('Email and password are required');
            }
        }
        
        const endpoint = '{{ mode }}' === 'register' ? '/register' : '/login';
        const result = await apiCall(endpoint, {
            method: 'POST',
            body: JSON.stringify(data)
        });
        
        if (result.success) {
            showAlert(result.message, 'success');
            
            // Redirect after successful auth
            setTimeout(() => {
                window.location.href = '/game';
            }, 1000);
        } else {
            throw new Error(result.error || 'Authentication failed');
        }
        
    } catch (error) {
        showAlert(error.message, 'error');
    } finally {
        hideLoading(submitBtn, originalText);
    }
});

// Auto-focus first input
document.addEventListener('DOMContentLoaded', function() {
    const firstInput = document.querySelector('input');
    if (firstInput) {
        firstInput.focus();
    }
});
</script>
{% endblock %}
